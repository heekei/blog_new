<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 学习总结 | Lorain&#39;s个人主页</title>
    <meta name="description" content="记录技术&amp;生活">
    <link rel="icon" href="/blog/hd-img.jpg">
  <link rel="manifest" href="/blog/hd-img.jpg">
  <link rel="apple-touch-icon" href="/blog/hd-img.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/blog/assets/css/0.styles.da38b4af.css" as="style"><link rel="preload" href="/blog/assets/js/app.5c37a012.js" as="script"><link rel="preload" href="/blog/assets/js/2.0cee91e7.js" as="script"><link rel="preload" href="/blog/assets/js/18.e762c11a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cbc53c3f.js"><link rel="prefetch" href="/blog/assets/js/11.84a8656a.js"><link rel="prefetch" href="/blog/assets/js/12.c605e0db.js"><link rel="prefetch" href="/blog/assets/js/13.2ec67b56.js"><link rel="prefetch" href="/blog/assets/js/14.ef5a7f40.js"><link rel="prefetch" href="/blog/assets/js/15.beadcec6.js"><link rel="prefetch" href="/blog/assets/js/16.88671c69.js"><link rel="prefetch" href="/blog/assets/js/17.260c5a16.js"><link rel="prefetch" href="/blog/assets/js/19.bab5260a.js"><link rel="prefetch" href="/blog/assets/js/20.d6e52d10.js"><link rel="prefetch" href="/blog/assets/js/3.822e9992.js"><link rel="prefetch" href="/blog/assets/js/4.be4cf9cd.js"><link rel="prefetch" href="/blog/assets/js/5.22a044fd.js"><link rel="prefetch" href="/blog/assets/js/6.46283c90.js"><link rel="prefetch" href="/blog/assets/js/7.8fc38ba3.js"><link rel="prefetch" href="/blog/assets/js/8.5aedffe8.js"><link rel="prefetch" href="/blog/assets/js/9.4216c03e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.da38b4af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Lorain's个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/skills/" class="nav-link router-link-active">记录技术</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">算法相关</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link">热爱生活</a></div><div class="nav-item"><a href="https://github.com/lorainwings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/skills/" class="nav-link router-link-active">记录技术</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">算法相关</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link">热爱生活</a></div><div class="nav-item"><a href="https://github.com/lorainwings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JS进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/skills/promise.html" class="sidebar-link">手写 Promise</a></li><li><a href="/blog/skills/base64.html" class="sidebar-link">关于 base64</a></li><li><a href="/blog/skills/babel总结.html" class="sidebar-link">Babel 知识点总结</a></li><li><a href="/blog/skills/rxjs初探.html" class="sidebar-link">RxJS 学习笔记</a></li><li><a href="/blog/skills/webpack学习.html" class="active sidebar-link">webpack 学习总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/skills/webpack学习.html#webpack-学习总结" class="sidebar-link">webpack 学习总结</a></li></ul></li><li><a href="/blog/skills/webpack模块实现.html" class="sidebar-link">webpack 模块加载的实现</a></li><li><a href="/blog/skills/event-loop.html" class="sidebar-link">Event Loop</a></li><li><a href="/blog/skills/git中~和^的用法分析.html" class="sidebar-link">Git 中^和~的区别</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Html5</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/skills/docker.html" class="sidebar-link">Docker 总结：《Docker 从入门到实战(黄靖钧)》</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="webpack-学习总结"><a href="#webpack-学习总结" class="header-anchor">#</a> webpack 学习总结</h2> <hr> <ol><li><h3 id="关于-module、chunk-以及-bundle-之间的区别"><a href="#关于-module、chunk-以及-bundle-之间的区别" class="header-anchor">#</a> 关于 module、chunk 以及 bundle 之间的区别</h3> <blockquote><p>module: 模块就是模块可以是 es 模块也可以是 commonJS 或者 AMD 模块</p></blockquote> <blockquote><p>chunk: 打包过程中被操作的模块文件叫做 chunk,例如异步加载一个模块就是一个 chunk</p></blockquote> <blockquote><p>bundle: bundle 是最后打包后的文件,最终文件可以和 chunk 长的一模一样,但是大部分情况下他是多个 chunk 的集合</p></blockquote> <hr> <p>另外的理解(摘至网络):</p> <ul><li><p>module：</p> <p>就是 js 的模块化 webpack 支持 commonJS、ES6 等模块化规范，简单来说就是你通过 import 语句引入的代码。</p></li> <li><p>chunk:</p> <p>chunk 是 webpack 根据功能拆分出来的，包含三种情况：</p> <p>1、你的项目入口（entry）</p> <p>2、通过 import()动态引入的代码</p> <p>3、通过 splitChunks 拆分出来的代码</p> <p>chunk 包含着 module，可能是一对多也可能是一对一。</p></li> <li><p>bundle：</p> <p>bundle 是 webpack 打包之后的各个文件，一般就是和 chunk 是一对一的关系，bundle 就是对 chunk 进行编译压缩打包等处理之后的产出。</p></li></ul></li></ol> <hr> <ol start="2"><li><h3 id="webpack-打包一个库的配置方法"><a href="#webpack-打包一个库的配置方法" class="header-anchor">#</a> webpack 打包一个库的<a href="https://github.com/webpack/webpack/tree/master/examples/multi-part-library" target="_blank" rel="noopener noreferrer">配置方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// mode: &quot;development || &quot;production&quot;,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    alpha<span class="token punctuation">:</span> <span class="token string">'./alpha'</span><span class="token punctuation">,</span>
    beta<span class="token punctuation">:</span> <span class="token string">'./beta'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span> <span class="token string">'MyLibrary.[name].js'</span><span class="token punctuation">,</span>
    <span class="token comment">// 征对多页面,可以配置为数组,MyLibrary作为整体的命名空间,[name]作为该空间的属性调用</span>
    <span class="token comment">// 示例地址:</span>
    <span class="token comment">//https://github.com/webpack/webpack/tree/master/examples/multi-part-library</span>
    library<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'MyLibrary'</span><span class="token punctuation">,</span> <span class="token string">'[name]'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    libraryTarget<span class="token punctuation">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol> <hr> <ol start="3"><li><h3 id="webpack-入口的配置方式"><a href="#webpack-入口的配置方式" class="header-anchor">#</a> webpack 入口的配置方式</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 对象式</span>
<span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span><span class="token punctuation">{</span>
    app<span class="token punctuation">:</span><span class="token string">'./file.js'</span><span class="token punctuation">,</span>
    vendor<span class="token punctuation">:</span> <span class="token string">'./file1.js'</span><span class="token punctuation">,</span> <span class="token comment">//多页面</span>
    normal<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">,</span><span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//两个chunk打包到一个bundle</span>
    <span class="token string">'js/home'</span><span class="token punctuation">:</span> <span class="token string">'./files2.js'</span> <span class="token comment">// 会生成到js/home文件夹下</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 字符串式</span>
<span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span><span class="token string">'app'</span> <span class="token comment">// 等同于 entry:{ main:'app.js' }</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><hr></li> <li><h3 id="关于-npm3-下-peerdependency"><a href="#关于-npm3-下-peerdependency" class="header-anchor">#</a> 关于 npm3 下 peerDependency</h3> <h4 id="例子"><a href="#例子" class="header-anchor">#</a> 例子:</h4> <blockquote><p>假如 项目 project-main 依赖的 package-a(dependency) 的 package.json 中声明了 peerDependency 是 package-apeer@^1.0.0，而 project-main 中没有任何 package-apeer 的配置，此时在 project-main 下使用 npm3 执行 npm install，控制台就会告警 UNMET PEER DEPENDENCY package-apeer@^1.0.0，意思就是说使用到 package-a 的项目必须安装同时安装 package-apeer@^1.0.0 ，否则程序就可能会有异常，而在 npm@1 和 npm@2 下，就不会报错而是自动把 package-apeer@^1.0.0 安装上，因为很多用户反应这样很困惑，我没声明这个包，你为什么要给我安装呢？所以在 npm@3 中这个 peerDependencies 如果没装就变成了控制台告警。</p></blockquote> <h4 id="npm3-的官方文档-中-记录到"><a href="#npm3-的官方文档-中-记录到" class="header-anchor">#</a> npm3 的官方文档  中  记录到:</h4> <blockquote><p>通常是在插件开发的场景下，你的插件需要某些依赖的支持，但是你又没必要去安装，因为插件的宿主会去安装这些依赖，你就可以用 peerDependencies 去声明一下需要依赖的插件和版本，如果出问题 npm 就会有警告来提醒使用者去解决版本冲突问题。</p></blockquote> <hr></li> <li><h3 id="html-webpack-plugin-疑惑选项"><a href="#html-webpack-plugin-疑惑选项" class="header-anchor">#</a> html-webpack-plugin 疑惑选项</h3></li></ol> <ul><li><h4 id="chunks"><a href="#chunks" class="header-anchor">#</a> chunks</h4> <blockquote><p>chunks 选项的作用主要是针对多入口(entry)文件。当你有多个入口文件的时候，对应就会生成多个编译后的 js 文件。那么 chunks 选项就可以决定是否都使用这些生成的 js 文件。</p></blockquote> <blockquote><p>chunks 默认会在生成的 html 文件中引用所有的 js 文件，当然你也可以指定引入哪些特定的文件。</p></blockquote> <blockquote><p>看一个小例子。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// webpack.config.js</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      index<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      index1<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index1.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      index2<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index2.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token operator">...</span>
          chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token string">'index2'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>执行 webpack 命令之后，你会看到生成的 index.html 文件中，只引用了 index.js 和 index2.js, 而如果没有指定 chunks 选项，默认会全部引用。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>text/javascript</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span>index.js</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>text/javascript</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span>index2.js</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><h4 id="excludechunks"><a href="#excludechunks" class="header-anchor">#</a> excludeChunks</h4> <p>弄懂了 chunks 之后，excludeChunks 选项也就好理解了，跟 chunks 是相反的，排除掉某些 js 文件。 比如上面的例子，其实等价于下面这一行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token operator">...</span>
  excludeChunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'index1.js'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr></li></ul> <ol start="6"><li><h3 id="loaders-配置项-use-和-loader-的区别"><a href="#loaders-配置项-use-和-loader-的区别" class="header-anchor">#</a> loaders 配置项 use 和 loader 的区别</h3> <p><a href="https://webpack.docschina.org/migrate/3/" target="_blank" rel="noopener noreferrer">参考链接-webpack1 升级 webpack2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>webpack1 是使用 loader 选项,而 webpack2 以上的版本都建议直接使用 use 选项,具体的更新如下:</p> <ul><li>外层 loaders 改为 rules</li> <li>内层 loader 改为 use,也可以用 loader</li> <li>所有插件必须加上 -loader，不再允许缩写</li> <li>不再支持使用!连接插件，改为数组形式</li> <li>json-loader 模块移除，不再需要手动添加，webpack2 会自动处理</li></ul> <p>#webpack1</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  loaders<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(less|css)$/</span><span class="token punctuation">,</span>
      loader<span class="token punctuation">:</span> <span class="token string">'style!css!less!postcss'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.json$/</span><span class="token punctuation">,</span>
      loader<span class="token punctuation">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>#Webpack2</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(less|css)$/</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>#使用示例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.jsx$/</span><span class="token punctuation">,</span>
      loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Do not use &quot;use&quot; here</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
      <span class="token comment">// 可以配置成字符串</span>
      loader<span class="token punctuation">:</span> <span class="token string">&quot;style-loader!css-loader!less-loader&quot;</span>
      <span class="token comment">// 也可以配置成数组,并通过queryString来设定选项(传参给loader)</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader?minimize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 使用options来设定选项</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              minimize<span class="token punctuation">:</span><span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>#补充:</p> <p>正如 Webpack 2 迁移教程所述，两者之间的区别在于，如果我们想要一个加载器数组，我们必须使用 use，如果它只是一个加载器，那么我们必须使用 loader：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.jsx$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Do not use &quot;use&quot; here</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">&quot;style-loader!css-loader!less-loader&quot;</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;less-loader&quot;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>`
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>loader 也可以使用 import 或者 require 直接指定:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'style-loader!css-loader?minimize!./main.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Styles <span class="token keyword">from</span> <span class="token string">'style-loader!css-loader?modules!./styles.css'</span><span class="token punctuation">;</span>
<span class="token comment">// 选项可以传递查询参数，例如 ?key=value&amp;foo=bar，或者一个 JSON 对象，例如 ?{&quot;key&quot;:&quot;value&quot;,&quot;foo&quot;:&quot;bar&quot;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>总结: loader 的几种用法:</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token number">1.</span> use<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'xxx-loader'</span><span class="token punctuation">,</span><span class="token string">'xxx-loader'</span><span class="token punctuation">]</span>

  <span class="token number">2.</span> loader<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>

  <span class="token number">3.</span> use<span class="token punctuation">:</span><span class="token punctuation">[</span>
     <span class="token punctuation">{</span>loader<span class="token punctuation">:</span><span class="token string">'style-loader'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span>loader<span class="token punctuation">:</span><span class="token string">'css-loader'</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr></li> <li><h3 id="常用-loaders-作用的归纳"><a href="#常用-loaders-作用的归纳" class="header-anchor">#</a> 常用 loaders 作用的归纳</h3></li></ol> <ul><li><h4 id="css-loader"><a href="#css-loader" class="header-anchor">#</a> css-loader</h4> <blockquote><p>css-laoder 是解释 @import 'a.css' 和 @import url(a.css)等引入的.css 文件, 将其加载到 js 文件中,便于 webpack 的其他 loader 处理</p></blockquote></li></ul> <ul><li><h4 id="style-loader"><a href="#style-loader" class="header-anchor">#</a> style-loader</h4> <blockquote><p>style-loaders 用于处理将所有的样式文件插入到<code>&lt;style&gt;&lt;/style&gt;</code>中</p></blockquote></li> <li><h4 id="url-loader"><a href="#url-loader" class="header-anchor">#</a> url-loader</h4> <blockquote><p>url-loader 是用于处理文件(css/js)中的中引用的资源. 例如图片引入, 小图片转换成 base64...</p></blockquote></li> <li><h4 id="postcss-loader"><a href="#postcss-loader" class="header-anchor">#</a> postcss-loader</h4> <blockquote><p>postcss-loader 的 autoprefixer 实现将 css3 属性添加上厂商前缀</p></blockquote> <hr></li></ul> <ol start="8"><li><h3 id="关于-husky-和-yorkie-原文地址"><a href="#关于-husky-和-yorkie-原文地址" class="header-anchor">#</a> 关于 husky 和 yorkie <a href="https://segmentfault.com/a/1190000016750078" target="_blank" rel="noopener noreferrer"># 原文地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <blockquote><h4 id="git-钩子介绍"><a href="#git-钩子介绍" class="header-anchor">#</a> <a href="https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90" target="_blank" rel="noopener noreferrer">git 钩子介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>客户端钩子包括：pre-commit、prepare-commit-msg、commit-msg、post-commit 等，主要用于控制客户端 git 的提交工作流。服务端钩子：pre-receive、post-receive、update，主要在服务端接收提交对象时、推送到服务器之前调用</p></blockquote> <blockquote><h4 id="关于-husky"><a href="#关于-husky" class="header-anchor">#</a> <a href="https://github.com/typicode/husky" target="_blank" rel="noopener noreferrer">关于 husky<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>husky 可以让 git hooks 的使用变得更简单方便。运行 npm install husky@next --save-dev 安装最新版本，它会在我们项目根目录下面的.git/hooks 文件夹下面创建 pre-commit、pre-push 等 hooks。这些 hooks 可以让我们直接在 package.json 的 script 里运行我们想要在某个 hook 阶段执行的命令</p></blockquote> <blockquote><p><strong>使用 husky 要注意，对应属性名已经改为 HUSKY_GIT_PARAMS , 而不是原始的 GIT_PARAMS 环境变量</strong></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
   <span class="token string">&quot;husky&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
     <span class="token string">&quot;hooks&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
       <span class="token string">&quot;pre-commit&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;lint-staged&quot;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
     <span class="token string">&quot;*.js&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;git add&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><h4 id="关于-youkie"><a href="#关于-youkie" class="header-anchor">#</a> <a href="https://github.com/yyx990803/yorkie" target="_blank" rel="noopener noreferrer">关于 youkie<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在 vue 最新的版本中，已经使用尤大改写的 youkie， youkie 实际是 fork husky,然后做了一些定制化的改动， 使得钩子能从 package.json 的 &quot;gitHooks&quot;属性中读取</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
 <span class="token string">&quot;gitHooks&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token string">&quot;pre-commit&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">,</span>
   <span class="token string">&quot;commit-msg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node scripts/verify-commit-msg.js&quot;</span> <span class="token comment">//t比提交信息检查 [连接](https://github.com/vuejs/vue/blob/dev/scripts/verify-commit-msg.js)</span>
 <span class="token punctuation">}</span>
 <span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token string">&quot;*.js&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
     <span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span>
     <span class="token string">&quot;git add&quot;</span>
   <span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><h4 id="关于-lint-staged"><a href="#关于-lint-staged" class="header-anchor">#</a> <a href="https://github.com/okonet/lint-staged" target="_blank" rel="noopener noreferrer">关于 lint-staged<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>只 lint 当前改动的文件，lint-staged 就非常准确的解决了这一问题，从这个包名，就可以看出，Run linters on git staged files，只针对改动的文件进行处理</p></blockquote> <hr></li> <li><h3 id="webpack-常用的-plugins-总结"><a href="#webpack-常用的-plugins-总结" class="header-anchor">#</a> webpack 常用的 plugins 总结</h3></li></ol> <ul><li><p>DllPlugin &amp; DllReferencePlugin (动态链接库插件)</p> <p>dll 插件一般只应用于开发环境,正式环境中不建议这么做</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 接入 DllPlugin</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 动态链接库的全局变量名称，需要和 output.library 中保持一致</span>
      <span class="token comment">// 该字段的值也就是输出的 manifest.json 文件 中 name 字段的值</span>
      name<span class="token punctuation">:</span> <span class="token string">'[name]_dll_[hash]'</span><span class="token punctuation">,</span>
      <span class="token comment">// 描述动态链接库的 manifest.json 文件输出时的文件名称</span>
      path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist/dll'</span><span class="token punctuation">,</span> <span class="token string">'[name].manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token comment">// 接入 DllPlugin</span>
  <span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    context<span class="token punctuation">:</span> __dirname<span class="token punctuation">,</span>
    <span class="token comment">// 描述 react 动态链接库的文件内容</span>
    manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/react.manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>webpack-bundle-analyzer (性能分析插件)</p></li></ul> <ul><li><p>WebpackMd5Hash</p> <p>注意: webpack-md5-hash 有相关问题请<a href="https://sebastianblade.com/using-webpack-to-achieve-long-term-cache/" target="_blank" rel="noopener noreferrer">查看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>使用该插件后,模块与公共代码的映射关系文件(manifest),将不会  随着模块的改动来重新  计算公共代码的 chunkhash</p></blockquote> <p>因此 webpack-md5-hash 并没有解决之前的问题：</p> <pre><code>如何生成稳定的模块 ID？

如何避免频繁的 chunk 内容变动？
</code></pre> <p>使用 NamedModulesPlugin 来解决</p></li></ul> <ul><li><p>NamedChunksPlugin</p> <p>webpack4.25 以上有两个选项来控制这个插件: namedChunks 和 chunkIds</p> <p>这两个插件在更高的版本已经合并为了 chunkIds,详见<a href="https://github.com/webpack/webpack/issues/8354" target="_blank" rel="noopener noreferrer">链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>固化 runtime 代码 内以及在使用动态加载时分离出的 chunk 的 chunk id</p></blockquote></li> <li><p>NamedModulesPlugin(webpack4 开发模式默认值,不需要单独配置了)</p> <blockquote><p>当开启 HMR 的时候使用该插件会显示模块的相对路径，建议用于开发环境。</p></blockquote> <blockquote><p>开发环境下使用来固化 module id</p></blockquote> <blockquote><p>webpack.NamedChunksPlugin 只能对普通的 Webpack 模块起作用，异步模块，external 模块是不会起作用的。</p></blockquote> <blockquote><p><strong>征对上述的问题解决办法:</strong></p></blockquote> <ol><li><p>异步模块可以在 import 的时候加上 chunkName 的注释，比如这样：import(/_ webpackChunkName: &quot;lodash&quot; _/ 'lodash').then() 这样就有 Name 了</p></li> <li><p>所以我们需要再使用一个插件：name-all-modules-plugin
这个插件中用到一些老的 API，Webpack 4 会发出警告，这个 <a href="https://github.com/timse/name-all-modules-plugin/pull/2/commits/18b460556e625908ca419c1e4798451ab0c5d788" target="_blank" rel="noopener noreferrer">pr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 有新的版本，不过作者不一定会 merge。我们使用的时候可以直接 copy 这个插件的代码到我们的 Webpack 配置里面。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">//pr的核心代码</span>
 <span class="token keyword">class</span> <span class="token class-name">NameAllModulesPlugin</span> <span class="token punctuation">{</span>
   <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;NameAllModulesPlugin&quot;</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeModuleIds<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;NameAllModulesPlugin&quot;</span><span class="token punctuation">,</span> <span class="token parameter">modules</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> module <span class="token keyword">of</span> modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             module<span class="token punctuation">.</span>id <span class="token operator">=</span> module<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol></li> <li><p>HashedModuleIdsPlugin</p> <blockquote><p>在生产环境下使用来固化 module id,就是在 namedModulesPlugin 的基础上做了路径的 hash,简化路径值, 减小 chunk 的</p></blockquote></li> <li><p>CommonsChunkPlugin(webpack3 中的公共代码提取插件)</p> <blockquote><p>HashedModuleIdsPlugin: 它是根据模块相对路径生成模块标识，如果模块没有改变，那模块标识也不会改变, 改变 webpack-&gt;entry 的顺序也将不改变模块的 ID, 也就不会影响 hash 和 chunkhash 的改变</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'common'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 用于提取manifest</span>
      minChunks<span class="token punctuation">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span> <span class="token comment">// Infinity不会打包任何多余的代码</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">WebpackMd5Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>splitChunks (webpack4)</p> <blockquote><p>默认的分包策略:(条件需要全满足)</p></blockquote> <pre><code>-  新的 chunk 是否被共享2次以上或者是来自 node_modules 的模块
-  新的 chunk 体积在压缩之前是否大于 30kb
-  按需加载 chunk 的并发请求数量小于等于 5 个
-  页面初始加载时的并发请求数量小于等于 3 个
</code></pre></li></ul> <blockquote><p>默认配置:</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 提取webpack运行时的代码块单独引入到入口文件</span>
    <span class="token comment">// 而不是直接混入每个chunk,可以减小入口的代码体积</span>
    <span class="token comment">// 存储着 webpack 对 module 和 chunk 的解析信息</span>
    <span class="token comment">// 主要作用: 把entry中不相关的 module id 或者说内容摒除在外</span>
    <span class="token comment">//</span>
    runtimeChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//范围:异步加载的模块中的引入import才进行拆分</span>
      chunks<span class="token punctuation">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// inital(入口) all(所有) async(异步)</span>
      minSize<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 大于30kb的</span>
      minChunks<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 引用一次就拆分</span>
      maxAsyncRequests<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 异步加载模块最多可以拆分的块数量</span>
      maxInitialRequests<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 一个入口模块最多可以拆分的块数量</span>
      automaticNameDelimiter<span class="token punctuation">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 模块拆分名称的连接符</span>
      <span class="token comment">// 值为true:webpack会基于代码块和缓存组的key自动选择一个名称</span>
      <span class="token comment">// 当一个名称匹配到相应的入口名称，这个入口会被移除。</span>
      name<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">//命中以下规则将被代码拆分</span>
      cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// node_modules中的模块</span>
          test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// default值改为false则关闭这个匹配条件</span>
          minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 页面引用2次以上的模块</span>
          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// 同优先级的规则,以从上到下来匹配</span>
          <span class="token comment">// 复用已经存在的代码块</span>
          <span class="token comment">// 需要在精确匹配到对应模块时候才会生效</span>
          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><blockquote><p>maxInitialRequests: 一个入口模块最多可以拆分的代码块 chunk 数量</p></blockquote> <pre><code>    * 规则:

    -  入口文件本身算一个请求
    -  如果入口里面有动态加载得模块这个不算在内
    -  通过 runtimeChunk 拆分出的 runtime 不算在内
    -  只算 js 文件的请求，css 不算在内
    -  如果同时又两个模块满足 cacheGroup 的规则要进行拆分，
      但是  maxInitialRequests 的值只能允许再拆分一个模块，
      那尺寸更大的模块会被拆分出来
</code></pre> <blockquote><p>maxAsyncRequests: 异步按需加载模块最多可拆分的代码块 chunk 数量</p></blockquote> <pre><code>    * 规则:

    - import()文件本身算一个请求
    - 并不算 js 以外的公共资源请求比如 css
    - 如果同时又两个模块满足 cacheGroup 的规则要进行拆分，
      但是 maxInitialRequests 的值只能允许再拆分一个模块，
      那尺寸更大的模块会被拆分出来
</code></pre> <ul><li><p>ParallelUglifyPlugin(并行插件)</p> <p>注意: 该插件已经无人  维护,可以用 terser-webpack-plugin</p> <p>这个插件可以帮助有很多入口点的项目加快构建速度。把对 JS 文件的串行压缩变为开启多个子进程并行进行 uglify。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpck.config.js</span>

<span class="token keyword">const</span> ParallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-parallel-uglify-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      workerCount<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      uglifyJS<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              beautify<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不需要格式化</span>
              comments<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// 保留注释</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          compress<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 压缩</span>
              warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 删除无用代码时不输出警告</span>
              drop_console<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 删除console语句</span>
              <span class="token comment">// 内嵌定义了但是只有用到一次的变量</span>
              collapse_vars<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span>
              reduce_vars<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>speed-measure-webpack-plugin</p> <p>用来检测 webpack 打包过程中各个部分所花费的时间</p></li> <li><p>webpack 动态引入资源, 使用 prefetch 和 preload</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpackChunkName: 打包后的文件名,防止出现1.js,2.js这种</span>
<span class="token comment">// webpackPrefetch: 开启prefetch (页面空闲时请求, 优先级中等)</span>
<span class="token comment">// webpackPreload: 开启preload (更高的优先级,不阻塞onload事件)</span>

<span class="token keyword">import</span><span class="token punctuation">(</span>
  <span class="token comment">/* webpackPrefetch: true */</span>
  <span class="token comment">/*webpackChunkName: 'topic'*/</span>

  <span class="token string">'../topic'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>ParallelUglifyPlugin(并行多进程压缩 js 文件)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 传递给 UglifyJS 的参数</span>
      uglifyJS<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 最紧凑的输出</span>
          beautify<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token comment">// 删除所有的注释</span>
          comments<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        compress<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 在UglifyJs删除没有用到的代码时不输出警告</span>
          warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token comment">// 删除所有的 `console` 语句，可以兼容ie浏览器</span>
          drop_console<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token comment">// 内嵌定义了但是只用到一次的变量</span>
          collapse_vars<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span>
          reduce_vars<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>ModuleConcatenationPlugin(开启 scope hosting 支持, 生产模式默认值)</p> <p>对于使用 ES6 的代码,分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。 因此只有那些被引用了一次的模块才能被合并</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ModuleConcatenationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/optimize/ModuleConcatenationPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 针对 Npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件</span>
    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'jsnext:main'</span><span class="token punctuation">,</span> <span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 开启 Scope Hoisting</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleConcatenationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>webpack.DefinePlugin(定义环境变量)</p> <p>该插件用于替换代码中的部分字段,例如定义了下面代码中的方式,那么在客户端中遇到 process.env.NODE_ENV 就会被替换成后面的值(webpack.DefinePlugin 将替换 process.env.NODE_ENV 为您定义的 development)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'process.env'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token constant">NODE_ENV</span><span class="token punctuation">:</span> <span class="token string">'&quot;development&quot;'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>terser-webpack-plugin</p> <p><a href="https://github.com/webpack-contrib/terser-webpack-plugin" target="_blank" rel="noopener noreferrer">terser-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个使用 terser 压缩 js 的 webpack 插件</p> <p>压缩是发布前处理最耗时间的一个步骤，如果是你是在 webpack 4 中，只要几行代码，即可加速你的构建发布速度</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span>
      parallel<span class="token punctuation">:</span> <span class="token boolean">true</span>   <span class="token comment">// 多线程</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <hr> <ol start="10"><li><h3 id="webpack-常用优化手段"><a href="#webpack-常用优化手段" class="header-anchor">#</a> webpack 常用优化手段</h3></li></ol> <ul><li><p>缩小搜索范围</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 由于 Loader 对文件的转换操作很耗时，需要让尽可能少的文件被 Loader 处理,可以通过 include 去命中只有哪些文件需要被处理。</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        include<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//一些库，例如 jQuery 、ChartJS， 它们庞大又没有采用模块化标准，让 Webpack 去解析这些文件耗时又没有意义</span>
    noParse<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/react\.min\.js$/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* 
  resolve.modules 的默认值是 ['node_modules']，含义是先去当前目录下的 ./node_modules 目录下去找想找的模块，如果没找到就去上一级目录 ../node_modules 中找，再没有就去 ../../node_modules 中找，以此类推，这和 Node.js 的模块寻找机制很相似。

  当安装的第三方模块都放在项目根目录下的 ./node_modules 目录下时，没有必要按照默认的方式去一层层的寻找，可以指明存放第三方模块的绝对路径，以减少寻找，配置如下
  */</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 入口文件配置</span>
    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/* 默认情况下 Webpack 会从入口文件 ./node_modules/react/react.js 开始递归的解析和处理依赖的几十个文件，这会时一个耗时的操作。 通过配置 resolve.alias 可以让 Webpack 在处理 React 库时，直接使用单独完整的 react.min.js 文件，从而跳过耗时的递归解析操作 */</span>
      react<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/dist/react.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/*  如果这个列表越长，或者正确的后缀在越后面，就会造成尝试的次数越多，所以 resolve.extensions 的配置也会影响到构建的性能。 在配置 resolve.extensions 时你需要遵守以下几点，以做到尽可能的优化构建性能：

    后缀尝试列表要尽可能的小，不要把项目中不可能存在的情况写到后缀尝试列表中。
    频率出现最高的文件后缀要优先放在最前面，以做到尽快的退出寻找过程。
    在源码中写导入语句时，要尽可能的带上后缀，从而可以避免寻找过程。例如在你确定的情况下把 require('./data') 写成 require('./data.json')。 */</span>
    extension<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><hr></li></ul> <ol start="11"><li>webpack 部分疑惑选项记录</li></ol> <ul><li><p>include/exclude/test 的区别</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// &quot;test&quot; is commonly used to match the file extension</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.jsx$/</span><span class="token punctuation">,</span>

        <span class="token comment">// &quot;include&quot; is commonly used to match the directories</span>
        include<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;app/src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;app/test&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// &quot;exclude&quot; should be used to exclude exceptions</span>
        <span class="token comment">// try to prefer &quot;include&quot; when possible</span>

        <span class="token comment">// the &quot;loader&quot;</span>
        loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span> <span class="token comment">// or &quot;babel&quot; because webpack adds the '-loader' automatically</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>output 选项的 chunkFilename</p> <p>作用: 配置无入口的 Chunk 在输出时的文件名称</p> <p>常见的会在运行时生成 Chunk 场景有在使用 CommonChunkPlugin、使用 import('path/to/module') 动态加载等时。 chunkFilename 支持和 filename 一致的内置变量</p></li> <li><p>提取公共代码插件 splitChunks 与 dllplugin 的区别:</p></li></ul> <p>总而言之，它们看起来很相似，但它们可以让你击中不同的目标。这么多，你可以考虑在开发环境中使用 DllPlugin（优点：编译时间短），同时使用 splitChunks 进行生产（优点：app 更改时的加载时间短）。同样，您也可以在生产中使用 DllPlugin，只需要连续运行两个版本的小麻烦：一个用于 DLL，另一个用于应用程序。</p> <p>附上 stackoverflow 中的<a href="https://stackoverflow.com/questions/41890855/webpack-common-chunks-plugin-vs-webpack-dll-plugin" target="_blank" rel="noopener noreferrer">分析连接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><p>output 选项中的[hash]以及[chunkhash]</p> <p>chunkhash 只能用于生产环境, 而 hash 一般用于开发环境,因为 chunkhash 与 HMR 冲突</p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">11/4/2019, 7:18:56 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/skills/rxjs初探.html" class="prev">RxJS 学习笔记</a></span> <span class="next"><a href="/blog/skills/webpack模块实现.html">webpack 模块加载的实现</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.5c37a012.js" defer></script><script src="/blog/assets/js/2.0cee91e7.js" defer></script><script src="/blog/assets/js/18.e762c11a.js" defer></script>
  </body>
</html>
